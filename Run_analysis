# Load required package
library(dplyr)

# Set working directory (adjust if needed)
setwd("C:/Users/ADMIN/Downloads/Compressed/getdata-projectfiles-UCI HAR Dataset/UCI HAR Dataset")

# 1. Read metadata
features <- read.table("features.txt", col.names = c("index", "feature"))
activities <- read.table("activity_labels.txt", col.names = c("code", "activity"))

# 2. Load and label training data
x_train <- read.table("train/X_train.txt", col.names = features$feature)
y_train <- read.table("train/y_train.txt", col.names = "Activity")
subject_train <- read.table("train/subject_train.txt", col.names = "Subject")

# 3. Load and label test data
x_test <- read.table("test/X_test.txt", col.names = features$feature)
y_test <- read.table("test/y_test.txt", col.names = "Activity")
subject_test <- read.table("test/subject_test.txt", col.names = "Subject")

# 4. Combine training and test datasets
X <- rbind(x_train, x_test)
Y <- rbind(y_train, y_test)
Subject <- rbind(subject_train, subject_test)

# 5. Merge into one dataset
merged_data <- cbind(Subject, Y, X)

# 6. Extract only mean() and std() measurements
tidy <- merged_data %>%
  select(Subject, Activity, contains("mean()"), contains("std()"))

# 7. Replace activity codes with descriptive names
tidy$Activity <- factor(tidy$Activity,
                        levels = activities$code,
                        labels = activities$activity)

# 8. Clean variable names
names(tidy) <- gsub("^t", "Time", names(tidy))
names(tidy) <- gsub("^f", "Frequency", names(tidy))
names(tidy) <- gsub("Acc", "Accelerometer", names(tidy))
names(tidy) <- gsub("Gyro", "Gyroscope", names(tidy))
names(tidy) <- gsub("Mag", "Magnitude", names(tidy))
names(tidy) <- gsub("BodyBody", "Body", names(tidy))

# 9. Create final tidy dataset with average of each variable by Subject and Activity
summary_data <- tidy %>%
  group_by(Subject, Activity) %>%
  summarise_all(mean)

# 10. Write output to file
write.table(summary_data, "tidy_dataset.txt", row.names = FALSE)
